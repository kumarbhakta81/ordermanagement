<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product - Order Management System</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../../css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../index.html">
                <i class="fas fa-boxes me-2"></i>OrderManagement
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../categories/category-list.html">
                            <i class="fas fa-tags me-1"></i>Categories
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="product-grid.html">
                            <i class="fas fa-box me-1"></i>Products
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="#" id="notificationsToggle">
                            <i class="fas fa-bell"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                3<span class="visually-hidden">unread messages</span>
                            </span>
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <span id="currentUserName">Admin User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="switchRole('wholesaler')">
                                <i class="fas fa-warehouse me-1"></i>Wholesaler View
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="switchRole('retailer')">
                                <i class="fas fa-store me-1"></i>Retailer View
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-1"></i>Settings</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-1"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-5 pt-3">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../../index.html">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="product-grid.html">Products</a></li>
                <li class="breadcrumb-item active" aria-current="page">Add Product</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">
                <i class="fas fa-plus me-2 text-primary"></i>Add New Product
            </h1>
            <div class="btn-toolbar mb-2 mb-md-0">
                <a href="product-grid.html" class="btn btn-sm btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Back to Products
                </a>
            </div>
        </div>

        <!-- Multi-step Form -->
        <div class="card shadow">
            <div class="card-header">
                <div class="row">
                    <div class="col-12">
                        <!-- Progress Steps -->
                        <div class="d-flex justify-content-between">
                            <div class="step-progress">
                                <div class="step step-active" data-step="1">
                                    <div class="step-circle">
                                        <i class="fas fa-info-circle"></i>
                                    </div>
                                    <div class="step-label">Basic Info</div>
                                </div>
                                <div class="step-line"></div>
                                <div class="step" data-step="2">
                                    <div class="step-circle">
                                        <i class="fas fa-images"></i>
                                    </div>
                                    <div class="step-label">Images</div>
                                </div>
                                <div class="step-line"></div>
                                <div class="step" data-step="3">
                                    <div class="step-circle">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                    <div class="step-label">Pricing</div>
                                </div>
                                <div class="step-line"></div>
                                <div class="step" data-step="4">
                                    <div class="step-circle">
                                        <i class="fas fa-boxes"></i>
                                    </div>
                                    <div class="step-label">Inventory</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card-body">
                <form id="productForm" novalidate>
                    <!-- Step 1: Basic Information -->
                    <div class="form-step active" data-step="1">
                        <h4 class="mb-4">Basic Product Information</h4>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="productName" class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" id="productName" required>
                                    <div class="invalid-feedback">Please provide a product name.</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="productDescription" class="form-label">Description</label>
                                    <textarea class="form-control" id="productDescription" rows="4" placeholder="Detailed product description..."></textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="productSKU" class="form-label">SKU *</label>
                                            <input type="text" class="form-control" id="productSKU" required>
                                            <div class="invalid-feedback">Please provide a unique SKU.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="productCategory" class="form-label">Category *</label>
                                            <select class="form-select" id="productCategory" required>
                                                <option value="">Select Category</option>
                                            </select>
                                            <div class="invalid-feedback">Please select a category.</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="productWeight" class="form-label">Weight (lbs)</label>
                                            <input type="number" class="form-control" id="productWeight" step="0.1" min="0">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="productDimensions" class="form-label">Dimensions</label>
                                            <input type="text" class="form-control" id="productDimensions" placeholder="L x W x H">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="productTags" class="form-label">Tags</label>
                                    <input type="text" class="form-control" id="productTags" placeholder="Enter tags separated by commas">
                                    <small class="form-text text-muted">Separate multiple tags with commas</small>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Product Status</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="productStatus" id="statusDraft" value="draft" checked>
                                        <label class="form-check-label" for="statusDraft">
                                            <i class="fas fa-edit text-secondary me-1"></i>Draft
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="productStatus" id="statusPending" value="pending">
                                        <label class="form-check-label" for="statusPending">
                                            <i class="fas fa-clock text-warning me-1"></i>Pending Review
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="productStatus" id="statusActive" value="approved">
                                        <label class="form-check-label" for="statusActive">
                                            <i class="fas fa-check-circle text-success me-1"></i>Active
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="productWholesaler" class="form-label">Wholesaler</label>
                                    <select class="form-select" id="productWholesaler">
                                        <option value="">Select Wholesaler</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Images -->
                    <div class="form-step" data-step="2">
                        <h4 class="mb-4">Product Images</h4>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label class="form-label">Upload Images</label>
                                    <div class="image-upload-area" id="imageUploadArea">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                        <h5 class="text-muted">Drag & Drop Images Here</h5>
                                        <p class="text-muted">or click to browse files</p>
                                        <input type="file" id="productImages" multiple accept="image/*" class="d-none">
                                        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('productImages').click()">
                                            <i class="fas fa-folder-open me-1"></i>Browse Files
                                        </button>
                                    </div>
                                    <small class="form-text text-muted">Upload up to 5 images. Supported formats: JPG, PNG, GIF. Max size: 5MB each.</small>
                                </div>
                                
                                <div id="imagePreviewContainer" class="row">
                                    <!-- Image previews will be shown here -->
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Image Guidelines</h6>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-unstyled mb-0">
                                            <li><i class="fas fa-check text-success me-2"></i>Use high-quality images</li>
                                            <li><i class="fas fa-check text-success me-2"></i>Show multiple angles</li>
                                            <li><i class="fas fa-check text-success me-2"></i>Include product in use</li>
                                            <li><i class="fas fa-check text-success me-2"></i>Good lighting and background</li>
                                            <li><i class="fas fa-check text-success me-2"></i>Consistent image sizes</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Pricing -->
                    <div class="form-step" data-step="3">
                        <h4 class="mb-4">Pricing Information</h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productPrice" class="form-label">Regular Price * ($)</label>
                                    <input type="number" class="form-control" id="productPrice" step="0.01" min="0" required>
                                    <div class="invalid-feedback">Please provide a valid price.</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="productSalePrice" class="form-label">Sale Price ($)</label>
                                    <input type="number" class="form-control" id="productSalePrice" step="0.01" min="0">
                                    <small class="form-text text-muted">Leave empty if no sale price</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="productCostPrice" class="form-label">Cost Price ($)</label>
                                    <input type="number" class="form-control" id="productCostPrice" step="0.01" min="0">
                                    <small class="form-text text-muted">Your cost for this product</small>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Pricing Summary</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-2">
                                            <div class="col-6">Regular Price:</div>
                                            <div class="col-6 text-end">$<span id="priceDisplay">0.00</span></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-6">Sale Price:</div>
                                            <div class="col-6 text-end text-danger">$<span id="salePriceDisplay">0.00</span></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-6">Cost Price:</div>
                                            <div class="col-6 text-end">$<span id="costPriceDisplay">0.00</span></div>
                                        </div>
                                        <hr>
                                        <div class="row">
                                            <div class="col-6"><strong>Profit Margin:</strong></div>
                                            <div class="col-6 text-end"><strong><span id="profitMarginDisplay">0%</span></strong></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Inventory -->
                    <div class="form-step" data-step="4">
                        <h4 class="mb-4">Inventory Management</h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productStock" class="form-label">Initial Stock Quantity *</label>
                                    <input type="number" class="form-control" id="productStock" min="0" required>
                                    <div class="invalid-feedback">Please provide initial stock quantity.</div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="productLowStockThreshold" class="form-label">Low Stock Alert Threshold</label>
                                    <input type="number" class="form-control" id="productLowStockThreshold" min="0" value="10">
                                    <small class="form-text text-muted">Get alerts when stock falls below this number</small>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="trackInventory" checked>
                                    <label class="form-check-label" for="trackInventory">
                                        Track inventory for this product
                                    </label>
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="allowBackorders">
                                    <label class="form-check-label" for="allowBackorders">
                                        Allow backorders when out of stock
                                    </label>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h6 class="mb-0">Inventory Status</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-2">
                                            <div class="col-6">Current Stock:</div>
                                            <div class="col-6 text-end"><span id="currentStockDisplay">0</span> units</div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-6">Low Stock Alert:</div>
                                            <div class="col-6 text-end"><span id="lowStockDisplay">10</span> units</div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-6">Status:</div>
                                            <div class="col-6 text-end">
                                                <span class="badge bg-success" id="stockStatusDisplay">In Stock</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="alert alert-info mt-3">
                                    <i class="fas fa-info-circle me-2"></i>
                                    <strong>Inventory Tracking:</strong> Enable inventory tracking to automatically update stock levels when orders are placed.
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="card-footer">
                <div class="d-flex justify-content-between">
                    <button type="button" class="btn btn-outline-secondary" id="prevBtn" onclick="changeStep(-1)" style="display: none;">
                        <i class="fas fa-arrow-left me-1"></i>Previous
                    </button>
                    <div class="ms-auto">
                        <button type="button" class="btn btn-outline-secondary me-2" onclick="saveDraft()">
                            <i class="fas fa-save me-1"></i>Save Draft
                        </button>
                        <button type="button" class="btn btn-primary" id="nextBtn" onclick="changeStep(1)">
                            Next<i class="fas fa-arrow-right ms-1"></i>
                        </button>
                        <button type="button" class="btn btn-success" id="submitBtn" onclick="submitProduct()" style="display: none;">
                            <i class="fas fa-check me-1"></i>Create Product
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light mt-5">
        <div class="container py-4">
            <div class="row">
                <div class="col-md-3">
                    <h5>Order Management</h5>
                    <p class="text-muted">Professional order management system for businesses of all sizes.</p>
                </div>
                <div class="col-md-3">
                    <h6>Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="../categories/category-list.html" class="text-muted">Categories</a></li>
                        <li><a href="product-grid.html" class="text-muted">Products</a></li>
                        <li><a href="../wholesaler-dashboard.html" class="text-muted">Wholesaler</a></li>
                        <li><a href="../retailer-dashboard.html" class="text-muted">Retailer</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Support</h6>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-muted">Help Center</a></li>
                        <li><a href="#" class="text-muted">Documentation</a></li>
                        <li><a href="#" class="text-muted">Contact Support</a></li>
                        <li><a href="#" class="text-muted">API Reference</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Connect</h6>
                    <div class="d-flex">
                        <a href="#" class="text-muted me-3"><i class="fab fa-twitter fa-lg"></i></a>
                        <a href="#" class="text-muted me-3"><i class="fab fa-facebook fa-lg"></i></a>
                        <a href="#" class="text-muted me-3"><i class="fab fa-linkedin fa-lg"></i></a>
                        <a href="#" class="text-muted"><i class="fab fa-github fa-lg"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2024 Order Management System. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">Made with <i class="fas fa-heart text-danger"></i> for businesses</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Mock Data -->
    <script src="../../js/mockData.js"></script>
    <!-- Main App -->
    <script src="../../js/app.js"></script>
    <!-- Product Form Script -->
    <script>
        let currentStep = 1;
        const totalSteps = 4;
        let uploadedImages = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadCategoryOptions();
            loadWholesalerOptions();
            setupEventListeners();
            updateStepDisplay();
        });

        // Load category options
        function loadCategoryOptions() {
            const categorySelect = document.getElementById('productCategory');
            window.mockData.categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });
        }

        // Load wholesaler options
        function loadWholesalerOptions() {
            const wholesalerSelect = document.getElementById('productWholesaler');
            window.mockData.wholesalers.forEach(wholesaler => {
                const option = document.createElement('option');
                option.value = wholesaler.id;
                option.textContent = wholesaler.name;
                wholesalerSelect.appendChild(option);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Pricing calculations
            document.getElementById('productPrice').addEventListener('input', updatePricingDisplay);
            document.getElementById('productSalePrice').addEventListener('input', updatePricingDisplay);
            document.getElementById('productCostPrice').addEventListener('input', updatePricingDisplay);

            // Inventory updates
            document.getElementById('productStock').addEventListener('input', updateInventoryDisplay);
            document.getElementById('productLowStockThreshold').addEventListener('input', updateInventoryDisplay);

            // Image upload
            const imageInput = document.getElementById('productImages');
            const uploadArea = document.getElementById('imageUploadArea');

            imageInput.addEventListener('change', handleImageUpload);

            // Drag and drop
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                handleFiles(files);
            });

            uploadArea.addEventListener('click', function() {
                imageInput.click();
            });

            // Auto-generate SKU from product name
            document.getElementById('productName').addEventListener('input', function() {
                const skuInput = document.getElementById('productSKU');
                if (!skuInput.value) {
                    const sku = this.value.toUpperCase()
                        .replace(/[^A-Z0-9]+/g, '')
                        .substring(0, 8) + '001';
                    skuInput.value = sku;
                }
            });
        }

        // Handle image upload
        function handleImageUpload(e) {
            handleFiles(e.target.files);
        }

        // Handle file processing
        function handleFiles(files) {
            const maxFiles = 5;
            const maxSize = 5 * 1024 * 1024; // 5MB

            for (let i = 0; i < Math.min(files.length, maxFiles - uploadedImages.length); i++) {
                const file = files[i];

                if (file.size > maxSize) {
                    showNotification(`File ${file.name} is too large. Maximum size is 5MB.`, 'warning');
                    continue;
                }

                if (!file.type.startsWith('image/')) {
                    showNotification(`File ${file.name} is not an image.`, 'warning');
                    continue;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = {
                        id: Date.now() + Math.random(),
                        name: file.name,
                        url: e.target.result,
                        file: file
                    };
                    uploadedImages.push(imageData);
                    displayImagePreview(imageData);
                };
                reader.readAsDataURL(file);
            }

            if (uploadedImages.length >= maxFiles) {
                document.getElementById('imageUploadArea').style.display = 'none';
            }
        }

        // Display image preview
        function displayImagePreview(imageData) {
            const container = document.getElementById('imagePreviewContainer');
            const previewDiv = document.createElement('div');
            previewDiv.className = 'col-md-4 mb-3';
            previewDiv.innerHTML = `
                <div class="card">
                    <img src="${imageData.url}" class="card-img-top" style="height: 150px; object-fit: cover;" alt="${imageData.name}">
                    <div class="card-body p-2">
                        <h6 class="card-title small mb-1">${imageData.name}</h6>
                        <button type="button" class="btn btn-sm btn-outline-danger w-100" onclick="removeImage('${imageData.id}')">
                            <i class="fas fa-trash me-1"></i>Remove
                        </button>
                    </div>
                </div>
            `;
            previewDiv.dataset.imageId = imageData.id;
            container.appendChild(previewDiv);
        }

        // Remove image
        function removeImage(imageId) {
            uploadedImages = uploadedImages.filter(img => img.id != imageId);
            const previewElement = document.querySelector(`[data-image-id="${imageId}"]`);
            if (previewElement) {
                previewElement.remove();
            }
            
            if (uploadedImages.length < 5) {
                document.getElementById('imageUploadArea').style.display = 'block';
            }
        }

        // Update pricing display
        function updatePricingDisplay() {
            const price = parseFloat(document.getElementById('productPrice').value) || 0;
            const salePrice = parseFloat(document.getElementById('productSalePrice').value) || 0;
            const costPrice = parseFloat(document.getElementById('productCostPrice').value) || 0;

            document.getElementById('priceDisplay').textContent = price.toFixed(2);
            document.getElementById('salePriceDisplay').textContent = salePrice.toFixed(2);
            document.getElementById('costPriceDisplay').textContent = costPrice.toFixed(2);

            // Calculate profit margin
            const effectivePrice = salePrice > 0 ? salePrice : price;
            const profit = effectivePrice - costPrice;
            const margin = costPrice > 0 ? (profit / effectivePrice * 100) : 0;
            
            document.getElementById('profitMarginDisplay').textContent = margin.toFixed(1) + '%';
        }

        // Update inventory display
        function updateInventoryDisplay() {
            const stock = parseInt(document.getElementById('productStock').value) || 0;
            const lowStockThreshold = parseInt(document.getElementById('productLowStockThreshold').value) || 10;

            document.getElementById('currentStockDisplay').textContent = stock;
            document.getElementById('lowStockDisplay').textContent = lowStockThreshold;

            const statusElement = document.getElementById('stockStatusDisplay');
            if (stock === 0) {
                statusElement.textContent = 'Out of Stock';
                statusElement.className = 'badge bg-danger';
            } else if (stock <= lowStockThreshold) {
                statusElement.textContent = 'Low Stock';
                statusElement.className = 'badge bg-warning';
            } else {
                statusElement.textContent = 'In Stock';
                statusElement.className = 'badge bg-success';
            }
        }

        // Change step
        function changeStep(direction) {
            const newStep = currentStep + direction;
            
            if (newStep < 1 || newStep > totalSteps) return;
            
            // Validate current step before proceeding
            if (direction > 0 && !validateStep(currentStep)) {
                return;
            }
            
            currentStep = newStep;
            updateStepDisplay();
        }

        // Validate step
        function validateStep(step) {
            const currentStepElement = document.querySelector(`.form-step[data-step="${step}"]`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                    field.classList.add('is-valid');
                }
            });

            if (!isValid) {
                showNotification('Please fill in all required fields before proceeding.', 'warning');
            }

            return isValid;
        }

        // Update step display
        function updateStepDisplay() {
            // Hide all steps
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
            });

            // Show current step
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');

            // Update progress indicators
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNumber = index + 1;
                if (stepNumber < currentStep) {
                    step.classList.add('step-completed');
                    step.classList.remove('step-active');
                } else if (stepNumber === currentStep) {
                    step.classList.add('step-active');
                    step.classList.remove('step-completed');
                } else {
                    step.classList.remove('step-active', 'step-completed');
                }
            });

            // Update buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');

            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            
            if (currentStep < totalSteps) {
                nextBtn.style.display = 'block';
                submitBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'block';
            }
        }

        // Save draft
        function saveDraft() {
            const productData = collectFormData();
            productData.status = 'draft';
            
            // Simulate saving
            showNotification('Draft saved successfully!', 'success');
        }

        // Submit product
        function submitProduct() {
            // Validate all steps
            for (let i = 1; i <= totalSteps; i++) {
                if (!validateStep(i)) {
                    currentStep = i;
                    updateStepDisplay();
                    return;
                }
            }

            const productData = collectFormData();
            
            // Add to mock data
            productData.id = Date.now();
            productData.createdAt = new Date().toISOString();
            productData.updatedAt = new Date().toISOString();
            
            window.mockData.products.push(productData);
            
            showNotification('Product created successfully!', 'success');
            
            // Redirect to products page after delay
            setTimeout(() => {
                window.location.href = 'product-grid.html';
            }, 2000);
        }

        // Collect form data
        function collectFormData() {
            const formData = {
                name: document.getElementById('productName').value,
                description: document.getElementById('productDescription').value,
                sku: document.getElementById('productSKU').value,
                categoryId: parseInt(document.getElementById('productCategory').value),
                categoryName: document.getElementById('productCategory').selectedOptions[0]?.textContent || '',
                price: parseFloat(document.getElementById('productPrice').value),
                salePrice: parseFloat(document.getElementById('productSalePrice').value) || null,
                costPrice: parseFloat(document.getElementById('productCostPrice').value) || 0,
                stock: parseInt(document.getElementById('productStock').value),
                lowStockThreshold: parseInt(document.getElementById('productLowStockThreshold').value),
                weight: parseFloat(document.getElementById('productWeight').value) || 0,
                dimensions: document.getElementById('productDimensions').value,
                tags: document.getElementById('productTags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
                status: document.querySelector('input[name="productStatus"]:checked').value,
                wholesalerId: parseInt(document.getElementById('productWholesaler').value) || null,
                wholesalerName: document.getElementById('productWholesaler').selectedOptions[0]?.textContent || '',
                images: uploadedImages.map(img => img.url),
                features: [] // Can be enhanced later
            };

            return formData;
        }

        // Make functions available globally
        window.changeStep = changeStep;
        window.saveDraft = saveDraft;
        window.submitProduct = submitProduct;
        window.removeImage = removeImage;
    </script>

    <style>
        .step-progress {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            margin-bottom: 8px;
        }

        .step-active .step-circle {
            background-color: var(--primary-color);
            color: white;
        }

        .step-completed .step-circle {
            background-color: var(--success-color);
            color: white;
        }

        .step-label {
            font-size: 0.8rem;
            text-align: center;
        }

        .step-line {
            height: 2px;
            background-color: #dee2e6;
            flex-grow: 1;
            margin: 0 1rem;
            align-self: flex-start;
            margin-top: 20px;
        }

        .step-completed + .step-line,
        .step-active + .step-line {
            background-color: var(--primary-color);
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .image-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 0.5rem;
            padding: 3rem 1rem;
            text-align: center;
            transition: border-color 0.15s ease-in-out;
            cursor: pointer;
        }

        .image-upload-area:hover,
        .image-upload-area.dragover {
            border-color: var(--primary-color);
            background-color: rgba(13, 110, 253, 0.05);
        }

        @media (max-width: 768px) {
            .step-progress {
                flex-direction: column;
            }
            
            .step-line {
                width: 2px;
                height: 30px;
                margin: 8px 0;
                align-self: center;
            }
        }
    </style>
</body>
</html>