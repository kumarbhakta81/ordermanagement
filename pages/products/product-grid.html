<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Order Management System</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../../css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../index.html">
                <i class="fas fa-boxes me-2"></i>OrderManagement
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../categories/category-list.html">
                            <i class="fas fa-tags me-1"></i>Categories
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="product-grid.html">
                            <i class="fas fa-box me-1"></i>Products
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="#" id="notificationsToggle">
                            <i class="fas fa-bell"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                3<span class="visually-hidden">unread messages</span>
                            </span>
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <span id="currentUserName">Admin User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="switchRole('wholesaler')">
                                <i class="fas fa-warehouse me-1"></i>Wholesaler View
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="switchRole('retailer')">
                                <i class="fas fa-store me-1"></i>Retailer View
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-1"></i>Settings</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-1"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-5 pt-3">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../../index.html">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page">Products</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">
                <i class="fas fa-box me-2 text-primary"></i>Product Management
            </h1>
            <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group me-2">
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleView('grid')" id="gridViewBtn">
                        <i class="fas fa-th me-1"></i>Grid
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleView('list')" id="listViewBtn">
                        <i class="fas fa-list me-1"></i>List
                    </button>
                </div>
                <div class="btn-group me-2">
                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="exportProducts()">
                        <i class="fas fa-download me-1"></i>Export
                    </button>
                </div>
                <a href="product-form.html" class="btn btn-sm btn-primary">
                    <i class="fas fa-plus me-1"></i>Add Product
                </a>
            </div>
        </div>

        <!-- Search and Filter Bar -->
        <div class="search-filter-bar">
            <div class="row">
                <div class="col-md-3">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control" id="searchProducts" placeholder="Search products...">
                    </div>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterCategory">
                        <option value="">All Categories</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterStatus">
                        <option value="">All Status</option>
                        <option value="approved">Approved</option>
                        <option value="pending">Pending</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="filterStock">
                        <option value="">All Stock</option>
                        <option value="in-stock">In Stock</option>
                        <option value="low-stock">Low Stock</option>
                        <option value="out-of-stock">Out of Stock</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="sortBy">
                        <option value="name">Sort by Name</option>
                        <option value="price">Sort by Price</option>
                        <option value="stock">Sort by Stock</option>
                        <option value="created">Sort by Date</option>
                    </select>
                </div>
                <div class="col-md-1">
                    <button class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Products Content -->
        <div id="productsContainer">
            <!-- Products will be loaded here -->
        </div>

        <!-- Pagination -->
        <nav aria-label="Products pagination" class="mt-4">
            <ul class="pagination justify-content-center" id="productPagination">
                <!-- Pagination will be generated dynamically -->
            </ul>
        </nav>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light mt-5">
        <div class="container py-4">
            <div class="row">
                <div class="col-md-3">
                    <h5>Order Management</h5>
                    <p class="text-muted">Professional order management system for businesses of all sizes.</p>
                </div>
                <div class="col-md-3">
                    <h6>Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="../categories/category-list.html" class="text-muted">Categories</a></li>
                        <li><a href="product-grid.html" class="text-muted">Products</a></li>
                        <li><a href="../wholesaler-dashboard.html" class="text-muted">Wholesaler</a></li>
                        <li><a href="../retailer-dashboard.html" class="text-muted">Retailer</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Support</h6>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-muted">Help Center</a></li>
                        <li><a href="#" class="text-muted">Documentation</a></li>
                        <li><a href="#" class="text-muted">Contact Support</a></li>
                        <li><a href="#" class="text-muted">API Reference</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Connect</h6>
                    <div class="d-flex">
                        <a href="#" class="text-muted me-3"><i class="fab fa-twitter fa-lg"></i></a>
                        <a href="#" class="text-muted me-3"><i class="fab fa-facebook fa-lg"></i></a>
                        <a href="#" class="text-muted me-3"><i class="fab fa-linkedin fa-lg"></i></a>
                        <a href="#" class="text-muted"><i class="fab fa-github fa-lg"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2024 Order Management System. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">Made with <i class="fas fa-heart text-danger"></i> for businesses</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Mock Data -->
    <script src="../../js/mockData.js"></script>
    <!-- Main App -->
    <script src="../../js/app.js"></script>
    <!-- Products Page Script -->
    <script>
        let currentView = 'grid';
        let currentPage = 1;
        let itemsPerPage = 12;
        let filteredProducts = [];
        let currentSort = 'name';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadCategoryOptions();
            loadProducts();
            setupEventListeners();
            
            // Check for category filter from URL
            const urlParams = new URLSearchParams(window.location.search);
            const categoryFilter = urlParams.get('category');
            if (categoryFilter) {
                document.getElementById('filterCategory').value = categoryFilter;
                filterProducts();
            }
        });

        // Load category options for filter
        function loadCategoryOptions() {
            const categorySelect = document.getElementById('filterCategory');
            const categories = window.mockData.categories;
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Search input
            document.getElementById('searchProducts').addEventListener('input', function() {
                filterProducts();
            });

            // Filter dropdowns
            document.getElementById('filterCategory').addEventListener('change', function() {
                filterProducts();
            });

            document.getElementById('filterStatus').addEventListener('change', function() {
                filterProducts();
            });

            document.getElementById('filterStock').addEventListener('change', function() {
                filterProducts();
            });

            document.getElementById('sortBy').addEventListener('change', function() {
                currentSort = this.value;
                filterProducts();
            });
        }

        // Load and display products
        function loadProducts() {
            filteredProducts = [...window.mockData.products];
            sortProducts();
            displayProducts();
            updatePagination();
        }

        // Filter products based on search and filters
        function filterProducts() {
            const searchTerm = document.getElementById('searchProducts').value.toLowerCase();
            const categoryFilter = document.getElementById('filterCategory').value;
            const statusFilter = document.getElementById('filterStatus').value;
            const stockFilter = document.getElementById('filterStock').value;

            filteredProducts = window.mockData.products.filter(product => {
                // Search filter
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) ||
                                    product.description.toLowerCase().includes(searchTerm) ||
                                    product.sku.toLowerCase().includes(searchTerm) ||
                                    product.tags.some(tag => tag.toLowerCase().includes(searchTerm));

                // Category filter
                const matchesCategory = !categoryFilter || product.categoryId.toString() === categoryFilter;

                // Status filter
                const matchesStatus = !statusFilter || product.status === statusFilter;

                // Stock filter
                let matchesStock = true;
                if (stockFilter === 'in-stock') {
                    matchesStock = product.stock > product.lowStockThreshold;
                } else if (stockFilter === 'low-stock') {
                    matchesStock = product.stock > 0 && product.stock <= product.lowStockThreshold;
                } else if (stockFilter === 'out-of-stock') {
                    matchesStock = product.stock === 0;
                }

                return matchesSearch && matchesCategory && matchesStatus && matchesStock;
            });

            currentPage = 1;
            sortProducts();
            displayProducts();
            updatePagination();
        }

        // Sort products
        function sortProducts() {
            filteredProducts.sort((a, b) => {
                switch (currentSort) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'price':
                        return (a.salePrice || a.price) - (b.salePrice || b.price);
                    case 'stock':
                        return b.stock - a.stock;
                    case 'created':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    default:
                        return 0;
                }
            });
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('searchProducts').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterStock').value = '';
            document.getElementById('sortBy').value = 'name';
            currentSort = 'name';
            loadProducts();
        }

        // Toggle between grid and list view
        function toggleView(view) {
            currentView = view;
            
            // Update button states
            document.getElementById('gridViewBtn').classList.toggle('active', view === 'grid');
            document.getElementById('listViewBtn').classList.toggle('active', view === 'list');
            
            displayProducts();
        }

        // Display products in current view
        function displayProducts() {
            const container = document.getElementById('productsContainer');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const productsToShow = filteredProducts.slice(startIndex, endIndex);

            if (productsToShow.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-box fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">No products found</h4>
                        <p class="text-muted">Try adjusting your search or filters, or add a new product.</p>
                        <a href="product-form.html" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>Add Product
                        </a>
                    </div>
                `;
                return;
            }

            if (currentView === 'grid') {
                displayProductsGrid(productsToShow);
            } else {
                displayProductsList(productsToShow);
            }
        }

        // Display products in grid view
        function displayProductsGrid(products) {
            const container = document.getElementById('productsContainer');
            const gridHtml = `
                <div class="row">
                    ${products.map(product => `
                        <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                            <div class="card product-card h-100">
                                <div class="position-relative">
                                    <img src="${product.images[0]}" class="card-img-top product-image" alt="${product.name}">
                                    <div class="position-absolute top-0 end-0 m-2">
                                        <span class="badge status-${product.status}">${product.status}</span>
                                    </div>
                                    ${product.stock <= product.lowStockThreshold ? 
                                        '<div class="position-absolute top-0 start-0 m-2"><span class="badge bg-warning">Low Stock</span></div>' : ''
                                    }
                                    ${product.salePrice ? 
                                        '<div class="position-absolute bottom-0 start-0 m-2"><span class="badge bg-danger">Sale</span></div>' : ''
                                    }
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">${product.name}</h5>
                                    <p class="card-text text-muted small">${product.description.substring(0, 100)}...</p>
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <div class="price">
                                            ${product.salePrice ? 
                                                `<span class="text-danger fw-bold">$${product.salePrice}</span>
                                                 <span class="text-muted text-decoration-line-through small">$${product.price}</span>` :
                                                `<span class="fw-bold">$${product.price}</span>`
                                            }
                                        </div>
                                        <small class="text-muted">Stock: ${product.stock}</small>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">
                                            <i class="fas fa-tag me-1"></i>${product.categoryName}
                                        </small>
                                        <small class="text-muted">SKU: ${product.sku}</small>
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent">
                                    <div class="btn-group w-100" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="editProduct(${product.id})" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-info" onclick="viewProduct(${product.id})" title="View Details">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-success" onclick="toggleProductStatus(${product.id})" title="Toggle Status">
                                            <i class="fas fa-toggle-${product.status === 'approved' ? 'on' : 'off'}"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${product.id})" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            container.innerHTML = gridHtml;
        }

        // Display products in list view
        function displayProductsList(products) {
            const container = document.getElementById('productsContainer');
            const listHtml = `
                <div class="card">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Category</th>
                                    <th>Price</th>
                                    <th>Stock</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${products.map(product => `
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <img src="${product.images[0]}" alt="${product.name}" 
                                                     class="rounded me-3" style="width: 60px; height: 60px; object-fit: cover;">
                                                <div>
                                                    <h6 class="mb-0">${product.name}</h6>
                                                    <small class="text-muted">SKU: ${product.sku}</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-light text-dark">${product.categoryName}</span>
                                        </td>
                                        <td>
                                            ${product.salePrice ? 
                                                `<span class="text-danger fw-bold">$${product.salePrice}</span><br>
                                                 <span class="text-muted text-decoration-line-through small">$${product.price}</span>` :
                                                `<span class="fw-bold">$${product.price}</span>`
                                            }
                                        </td>
                                        <td>
                                            <span class="badge ${product.stock <= product.lowStockThreshold ? 'bg-warning' : 'bg-success'} text-dark">
                                                ${product.stock}
                                            </span>
                                            ${product.stock <= product.lowStockThreshold ? '<br><small class="text-warning">Low Stock</small>' : ''}
                                        </td>
                                        <td>
                                            <span class="badge status-${product.status}">${product.status}</span>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button type="button" class="btn btn-outline-primary" onclick="editProduct(${product.id})" title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button type="button" class="btn btn-outline-info" onclick="viewProduct(${product.id})" title="View Details">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button type="button" class="btn btn-outline-success" onclick="toggleProductStatus(${product.id})" title="Toggle Status">
                                                    <i class="fas fa-toggle-${product.status === 'approved' ? 'on' : 'off'}"></i>
                                                </button>
                                                <button type="button" class="btn btn-outline-danger" onclick="deleteProduct(${product.id})" title="Delete">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            container.innerHTML = listHtml;
        }

        // Update pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            const pagination = document.getElementById('productPagination');

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHtml = '';

            // Previous button
            paginationHtml += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHtml += `
                        <li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHtml += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }

            // Next button
            paginationHtml += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;

            pagination.innerHTML = paginationHtml;
        }

        // Change page
        function changePage(page) {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                displayProducts();
                updatePagination();
                window.scrollTo(0, 0);
            }
        }

        // Edit product
        function editProduct(productId) {
            window.location.href = `product-form.html?id=${productId}`;
        }

        // View product details
        function viewProduct(productId) {
            const product = window.mockData.products.find(prod => prod.id === productId);
            if (product) {
                showProductDetailsModal(product);
            }
        }

        // Show product details modal
        function showProductDetailsModal(product) {
            const modalHtml = `
                <div class="modal fade" id="productDetailsModal" tabindex="-1" aria-labelledby="productDetailsModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="productDetailsModalLabel">
                                    <i class="fas fa-box me-2"></i>${product.name}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div id="productImageCarousel" class="carousel slide" data-bs-ride="carousel">
                                            <div class="carousel-inner">
                                                ${product.images.map((image, index) => `
                                                    <div class="carousel-item ${index === 0 ? 'active' : ''}">
                                                        <img src="${image}" class="d-block w-100 rounded" alt="${product.name}" style="height: 400px; object-fit: cover;">
                                                    </div>
                                                `).join('')}
                                            </div>
                                            ${product.images.length > 1 ? `
                                                <button class="carousel-control-prev" type="button" data-bs-target="#productImageCarousel" data-bs-slide="prev">
                                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                    <span class="visually-hidden">Previous</span>
                                                </button>
                                                <button class="carousel-control-next" type="button" data-bs-target="#productImageCarousel" data-bs-slide="next">
                                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                    <span class="visually-hidden">Next</span>
                                                </button>
                                            ` : ''}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <h4>${product.name}</h4>
                                            <p class="text-muted">${product.description}</p>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Price:</strong><br>
                                                ${product.salePrice ? 
                                                    `<span class="text-danger h5">$${product.salePrice}</span>
                                                     <span class="text-muted text-decoration-line-through">$${product.price}</span>` :
                                                    `<span class="h5">$${product.price}</span>`
                                                }
                                            </div>
                                            <div class="col-6">
                                                <strong>Stock:</strong><br>
                                                <span class="badge ${product.stock <= product.lowStockThreshold ? 'bg-warning' : 'bg-success'} text-dark">
                                                    ${product.stock} units
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="row mb-3">
                                            <div class="col-6">
                                                <strong>Category:</strong><br>
                                                <span class="badge bg-primary">${product.categoryName}</span>
                                            </div>
                                            <div class="col-6">
                                                <strong>Status:</strong><br>
                                                <span class="badge status-${product.status}">${product.status}</span>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <strong>SKU:</strong> ${product.sku}<br>
                                            <strong>Wholesaler:</strong> ${product.wholesalerName}
                                        </div>
                                        
                                        <div class="mb-3">
                                            <strong>Features:</strong>
                                            <ul class="list-unstyled">
                                                ${product.features.map(feature => `<li><i class="fas fa-check text-success me-2"></i>${feature}</li>`).join('')}
                                            </ul>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <strong>Tags:</strong><br>
                                            ${product.tags.map(tag => `<span class="badge bg-light text-dark me-1">${tag}</span>`).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-outline-primary" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit me-1"></i>Edit Product
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('productDetailsModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('productDetailsModal'));
            modal.show();
        }

        // Toggle product status
        function toggleProductStatus(productId) {
            const product = window.mockData.products.find(prod => prod.id === productId);
            if (product) {
                if (product.status === 'approved') {
                    product.status = 'pending';
                } else if (product.status === 'pending') {
                    product.status = 'approved';
                } else {
                    product.status = 'approved';
                }
                
                product.updatedAt = new Date().toISOString();
                
                displayProducts();
                showNotification(`Product status updated to ${product.status}`, 'success');
            }
        }

        // Delete product
        function deleteProduct(productId) {
            const product = window.mockData.products.find(prod => prod.id === productId);
            if (product && confirm(`Are you sure you want to delete "${product.name}"?`)) {
                const index = window.mockData.products.findIndex(prod => prod.id === productId);
                if (index > -1) {
                    window.mockData.products.splice(index, 1);
                    filterProducts();
                    showNotification(`Product "${product.name}" deleted successfully`, 'success');
                }
            }
        }

        // Export products
        function exportProducts() {
            const csvContent = "data:text/csv;charset=utf-8," + 
                "Name,SKU,Category,Price,Sale Price,Stock,Status\n" +
                filteredProducts.map(product => 
                    `"${product.name}","${product.sku}","${product.categoryName}","${product.price}","${product.salePrice || ''}","${product.stock}","${product.status}"`
                ).join("\n");
                
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "products.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Products exported successfully', 'success');
        }

        // Make functions available globally
        window.toggleView = toggleView;
        window.clearFilters = clearFilters;
        window.changePage = changePage;
        window.editProduct = editProduct;
        window.viewProduct = viewProduct;
        window.toggleProductStatus = toggleProductStatus;
        window.deleteProduct = deleteProduct;
        window.exportProducts = exportProducts;
    </script>
</body>
</html>