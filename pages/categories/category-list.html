<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Categories - Order Management System</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../../css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../index.html">
                <i class="fas fa-boxes me-2"></i>OrderManagement
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html">
                            <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="category-list.html">
                            <i class="fas fa-tags me-1"></i>Categories
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../products/product-grid.html">
                            <i class="fas fa-box me-1"></i>Products
                        </a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link position-relative" href="#" id="notificationsToggle">
                            <i class="fas fa-bell"></i>
                            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                                3<span class="visually-hidden">unread messages</span>
                            </span>
                        </a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>
                            <span id="currentUserName">Admin User</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="#" onclick="switchRole('wholesaler')">
                                <i class="fas fa-warehouse me-1"></i>Wholesaler View
                            </a></li>
                            <li><a class="dropdown-item" href="#" onclick="switchRole('retailer')">
                                <i class="fas fa-store me-1"></i>Retailer View
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-cog me-1"></i>Settings</a></li>
                            <li><a class="dropdown-item" href="#"><i class="fas fa-sign-out-alt me-1"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-5 pt-3">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../../index.html">Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page">Categories</li>
            </ol>
        </nav>

        <!-- Page Header -->
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">
                <i class="fas fa-tags me-2 text-primary"></i>Category Management
            </h1>
            <div class="btn-toolbar mb-2 mb-md-0">
                <div class="btn-group me-2">
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleView('grid')" id="gridViewBtn">
                        <i class="fas fa-th me-1"></i>Grid
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="toggleView('list')" id="listViewBtn">
                        <i class="fas fa-list me-1"></i>List
                    </button>
                </div>
                <button type="button" class="btn btn-sm btn-primary" onclick="showCategoryModal()">
                    <i class="fas fa-plus me-1"></i>Add Category
                </button>
            </div>
        </div>

        <!-- Search and Filter Bar -->
        <div class="search-filter-bar">
            <div class="row">
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control" id="searchCategories" placeholder="Search categories...">
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterStatus">
                        <option value="">All Status</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="filterParent">
                        <option value="">All Categories</option>
                        <option value="root">Root Categories Only</option>
                        <option value="child">Child Categories Only</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                        <i class="fas fa-times me-1"></i>Clear
                    </button>
                </div>
            </div>
        </div>

        <!-- Categories Content -->
        <div id="categoriesContainer">
            <!-- Categories will be loaded here -->
        </div>

        <!-- Pagination -->
        <nav aria-label="Categories pagination" class="mt-4">
            <ul class="pagination justify-content-center" id="categoryPagination">
                <!-- Pagination will be generated dynamically -->
            </ul>
        </nav>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light mt-5">
        <div class="container py-4">
            <div class="row">
                <div class="col-md-3">
                    <h5>Order Management</h5>
                    <p class="text-muted">Professional order management system for businesses of all sizes.</p>
                </div>
                <div class="col-md-3">
                    <h6>Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="category-list.html" class="text-muted">Categories</a></li>
                        <li><a href="../products/product-grid.html" class="text-muted">Products</a></li>
                        <li><a href="../wholesaler-dashboard.html" class="text-muted">Wholesaler</a></li>
                        <li><a href="../retailer-dashboard.html" class="text-muted">Retailer</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Support</h6>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-muted">Help Center</a></li>
                        <li><a href="#" class="text-muted">Documentation</a></li>
                        <li><a href="#" class="text-muted">Contact Support</a></li>
                        <li><a href="#" class="text-muted">API Reference</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Connect</h6>
                    <div class="d-flex">
                        <a href="#" class="text-muted me-3"><i class="fab fa-twitter fa-lg"></i></a>
                        <a href="#" class="text-muted me-3"><i class="fab fa-facebook fa-lg"></i></a>
                        <a href="#" class="text-muted me-3"><i class="fab fa-linkedin fa-lg"></i></a>
                        <a href="#" class="text-muted"><i class="fab fa-github fa-lg"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="mb-0">&copy; 2024 Order Management System. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">Made with <i class="fas fa-heart text-danger"></i> for businesses</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Mock Data -->
    <script src="../../js/mockData.js"></script>
    <!-- Main App -->
    <script src="../../js/app.js"></script>
    <!-- Categories Page Script -->
    <script>
        let currentView = 'grid';
        let currentPage = 1;
        let itemsPerPage = 12;
        let filteredCategories = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadCategories();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Search input
            document.getElementById('searchCategories').addEventListener('input', function() {
                filterCategories();
            });

            // Filter dropdowns
            document.getElementById('filterStatus').addEventListener('change', function() {
                filterCategories();
            });

            document.getElementById('filterParent').addEventListener('change', function() {
                filterCategories();
            });
        }

        // Load and display categories
        function loadCategories() {
            filteredCategories = [...window.mockData.categories];
            displayCategories();
            updatePagination();
        }

        // Filter categories based on search and filters
        function filterCategories() {
            const searchTerm = document.getElementById('searchCategories').value.toLowerCase();
            const statusFilter = document.getElementById('filterStatus').value;
            const parentFilter = document.getElementById('filterParent').value;

            filteredCategories = window.mockData.categories.filter(category => {
                // Search filter
                const matchesSearch = category.name.toLowerCase().includes(searchTerm) ||
                                    category.description.toLowerCase().includes(searchTerm);

                // Status filter
                const matchesStatus = !statusFilter || category.status === statusFilter;

                // Parent filter
                let matchesParent = true;
                if (parentFilter === 'root') {
                    matchesParent = category.parentId === null;
                } else if (parentFilter === 'child') {
                    matchesParent = category.parentId !== null;
                }

                return matchesSearch && matchesStatus && matchesParent;
            });

            currentPage = 1;
            displayCategories();
            updatePagination();
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('searchCategories').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterParent').value = '';
            loadCategories();
        }

        // Toggle between grid and list view
        function toggleView(view) {
            currentView = view;
            
            // Update button states
            document.getElementById('gridViewBtn').classList.toggle('active', view === 'grid');
            document.getElementById('listViewBtn').classList.toggle('active', view === 'list');
            
            displayCategories();
        }

        // Display categories in current view
        function displayCategories() {
            const container = document.getElementById('categoriesContainer');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const categoriesToShow = filteredCategories.slice(startIndex, endIndex);

            if (categoriesToShow.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-tags fa-3x text-muted mb-3"></i>
                        <h4 class="text-muted">No categories found</h4>
                        <p class="text-muted">Try adjusting your search or filters, or add a new category.</p>
                        <button class="btn btn-primary" onclick="showCategoryModal()">
                            <i class="fas fa-plus me-1"></i>Add Category
                        </button>
                    </div>
                `;
                return;
            }

            if (currentView === 'grid') {
                displayCategoriesGrid(categoriesToShow);
            } else {
                displayCategoriesList(categoriesToShow);
            }
        }

        // Display categories in grid view
        function displayCategoriesGrid(categories) {
            const container = document.getElementById('categoriesContainer');
            const gridHtml = `
                <div class="row">
                    ${categories.map(category => `
                        <div class="col-xl-3 col-lg-4 col-md-6 mb-4">
                            <div class="card category-card h-100">
                                <img src="${category.image}" class="card-img-top category-image" alt="${category.name}">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h5 class="card-title mb-0">${category.name}</h5>
                                        <span class="badge status-${category.status}">${category.status}</span>
                                    </div>
                                    <p class="card-text text-muted small">${category.description}</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-muted">
                                            <i class="fas fa-box me-1"></i>${category.productCount} products
                                        </small>
                                        ${category.parentId ? 
                                            `<small class="text-muted">
                                                <i class="fas fa-layer-group me-1"></i>Sub-category
                                            </small>` : 
                                            `<small class="text-muted">
                                                <i class="fas fa-star me-1"></i>Root category
                                            </small>`
                                        }
                                    </div>
                                </div>
                                <div class="card-footer bg-transparent">
                                    <div class="btn-group w-100" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="editCategory(${category.id})">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-info" onclick="viewCategoryProducts(${category.id})">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-success" onclick="toggleCategoryStatus(${category.id})">
                                            <i class="fas fa-toggle-${category.status === 'active' ? 'on' : 'off'}"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteCategory(${category.id})">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            container.innerHTML = gridHtml;
        }

        // Display categories in list view
        function displayCategoriesList(categories) {
            const container = document.getElementById('categoriesContainer');
            const listHtml = `
                <div class="card">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Description</th>
                                    <th>Products</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${categories.map(category => `
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <img src="${category.image}" alt="${category.name}" 
                                                     class="rounded me-3" style="width: 50px; height: 50px; object-fit: cover;">
                                                <div>
                                                    <h6 class="mb-0">${category.name}</h6>
                                                    <small class="text-muted">${category.slug}</small>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <p class="mb-0">${category.description}</p>
                                        </td>
                                        <td>
                                            <span class="badge bg-light text-dark">${category.productCount}</span>
                                        </td>
                                        <td>
                                            ${category.parentId ? 
                                                '<span class="badge bg-secondary">Sub-category</span>' : 
                                                '<span class="badge bg-primary">Root</span>'
                                            }
                                        </td>
                                        <td>
                                            <span class="badge status-${category.status}">${category.status}</span>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button type="button" class="btn btn-outline-primary" onclick="editCategory(${category.id})" title="Edit">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button type="button" class="btn btn-outline-info" onclick="viewCategoryProducts(${category.id})" title="View Products">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button type="button" class="btn btn-outline-success" onclick="toggleCategoryStatus(${category.id})" title="Toggle Status">
                                                    <i class="fas fa-toggle-${category.status === 'active' ? 'on' : 'off'}"></i>
                                                </button>
                                                <button type="button" class="btn btn-outline-danger" onclick="deleteCategory(${category.id})" title="Delete">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            container.innerHTML = listHtml;
        }

        // Update pagination
        function updatePagination() {
            const totalPages = Math.ceil(filteredCategories.length / itemsPerPage);
            const pagination = document.getElementById('categoryPagination');

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHtml = '';

            // Previous button
            paginationHtml += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHtml += `
                        <li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHtml += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
                }
            }

            // Next button
            paginationHtml += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;

            pagination.innerHTML = paginationHtml;
        }

        // Change page
        function changePage(page) {
            const totalPages = Math.ceil(filteredCategories.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                displayCategories();
                updatePagination();
                window.scrollTo(0, 0);
            }
        }

        // Edit category
        function editCategory(categoryId) {
            const category = window.mockData.categories.find(cat => cat.id === categoryId);
            if (category) {
                showCategoryModal(category);
            }
        }

        // View category products
        function viewCategoryProducts(categoryId) {
            window.location.href = `../products/product-grid.html?category=${categoryId}`;
        }

        // Toggle category status
        function toggleCategoryStatus(categoryId) {
            const category = window.mockData.categories.find(cat => cat.id === categoryId);
            if (category) {
                category.status = category.status === 'active' ? 'inactive' : 'active';
                category.updatedAt = new Date().toISOString();
                
                displayCategories();
                showNotification(`Category status updated to ${category.status}`, 'success');
            }
        }

        // Delete category
        function deleteCategory(categoryId) {
            const category = window.mockData.categories.find(cat => cat.id === categoryId);
            if (category && confirm(`Are you sure you want to delete "${category.name}"?`)) {
                const index = window.mockData.categories.findIndex(cat => cat.id === categoryId);
                if (index > -1) {
                    window.mockData.categories.splice(index, 1);
                    filterCategories();
                    showNotification(`Category "${category.name}" deleted successfully`, 'success');
                }
            }
        }

        // Make functions available globally
        window.toggleView = toggleView;
        window.clearFilters = clearFilters;
        window.changePage = changePage;
        window.editCategory = editCategory;
        window.viewCategoryProducts = viewCategoryProducts;
        window.toggleCategoryStatus = toggleCategoryStatus;
        window.deleteCategory = deleteCategory;
    </script>
</body>
</html>